<html>

  <head>
      <title>Uhoh</title>
  </head>

  <style>

      body
      {
        margin: 0;
        background-color: #ffffff;
      }

      .alert_red
      {
        margin-bottom: 1px;
        background-color: #EF0000;
        color: #ffffff;
        font-family: 'Roboto', arial, sans-serif;
        font-size: 12pt;
        font-weight: normal;
        padding: 10px;
      }

      .alert_amber
      {
        margin-bottom: 1px;
        background-color: #FCA800;
        color: #444444;
        font-family: 'Roboto', arial, sans-serif;
        font-size: 12pt;
        font-weight: normal;
        padding: 10px;
      }

      .alert_green
      {
        margin-bottom: 1px;
        background-color: #aaffaa;
        color: #666666;
        font-family: 'Roboto', arial, sans-serif;
        font-size: 12pt;
        font-weight: normal;
        padding: 10px;
      }

      .chartbar
      {
        background-color: #ffffff;
        color: #000000;
        font-family: 'Roboto', arial, sans-serif;
        font-size: 14pt;
        font-weight: bold;
        padding: 0px;
        padding-top: 10px;
        padding-bottom: 10px;
        position: fixed;
        height: 150px;
        width: 100%;
      }

  </style>

  <link href='https://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>

  <script src="https://ajax.googleapis.com/ajax/libs/mootools/1.5.2/mootools.min.js"></script>

  <script>

      window.addEvent('domready', function()
      {
        do_fetch();
        do_fade_out();
      });

      function do_fetch()
      {
        var ajax = new Request({ noCache: true, url: "/ui", onSuccess: function(responseText, responseXML) { do_render(responseText) }, onFailure: function() { errbox() }, onException: function() { errbox() } });
        ajax.get();

        setTimeout(function() { do_fetch(); }, 20000);
      }

      function do_fade_out()
      {
        var red_alerts = $$('#alerts div.alert_red');

        for(var rdi = 0; rdi < red_alerts.length; rdi ++)
        {
          red_alerts[rdi].fade('0.2');
        }

        setTimeout(function() { do_fade_in(); }, 500);
      }

      function do_fade_in()
      {
        var red_alerts = $$('#alerts div.alert_red');

        for(var rdi = 0; rdi < red_alerts.length; rdi ++)
        {
          red_alerts[rdi].fade('1');
        }

        setTimeout(function() { do_fade_out(); }, 3000);
      }

      function do_render(responseText)
      {
        var obj = JSON.decode(responseText);
        var response = "";

        if(obj.status != "ok")
        {
          alert("The server returned an error");
        }
        else
        {
          response += get_alerts(obj.red, "alert_red");
          response += get_alerts(obj.amber, "alert_amber");
          response += get_alerts(obj.green, "alert_green");
        }

        $('alerts').innerHTML = response;
      }

      function get_alerts(aobj, categ)
      {
        var html = "";

        for(var i = 0; i < aobj.length; i ++)
        {
          html += ( "<div class=\"" + categ + "\">" + aobj[i] + "</div>" );
        }

        return(html);
      }

      function errbox()
      {
        alert("Error calling the server");
      }

  </script>

  <body>

    <div id="alerts"></div>

  </body>

</html>